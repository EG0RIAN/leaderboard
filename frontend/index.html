<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>–õ–∏–¥–µ—Ä–±–æ—Ä–¥ –¥–æ–Ω–∞—Ç–æ–≤</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@telegram-apps/sdk@2.0.0/dist/css/style.css">
    <link rel="stylesheet" href="styles.css?v=4">
    <script src="https://unpkg.com/@tonconnect/ui@2.0.0/dist/tonconnect-ui.min.js"></script>
    <script src="translations.js"></script>
    <script>
        // Set API URL - production server
        window.API_URL = 'https://v3022889.hosted-by-vdsina.ru';
        // Set language on page load
        setLanguage();
    </script>
</head>
<body>
    <!-- Onboarding Stories -->
    <div id="onboarding" class="onboarding-overlay">
        <div class="stories-container">
            <!-- Progress bar -->
            <div class="stories-progress">
                <div class="progress-segment" data-story="0"><div class="progress-fill"></div></div>
                <div class="progress-segment" data-story="1"><div class="progress-fill"></div></div>
                <div class="progress-segment" data-story="2"><div class="progress-fill"></div></div>
                <div class="progress-segment" data-story="3"><div class="progress-fill"></div></div>
                <div class="progress-segment" data-story="4"><div class="progress-fill"></div></div>
            </div>
            
            <!-- Stories content -->
            <div class="stories-slides">
                <!-- Story 1: Welcome -->
                <div class="story-slide active" data-story="0">
                    <div class="story-content">
                        <div class="story-emoji">üèÜ</div>
                        <h1 data-i18n="onboardingTitle1">–°–∞–º—ã–π —á–µ—Å—Ç–Ω—ã–π –ª–∏–¥–µ—Ä–±–æ—Ä–¥</h1>
                        <p data-i18n="onboardingText1">–í—Å—Ç—Ä–µ—á–∞–π—Ç–µ —Å–∞–º—ã–π —á–µ—Å—Ç–Ω—ã–π –ª–∏–¥–µ—Ä–±–æ—Ä–¥ –≤ Telegram!</p>
                    </div>
                </div>
                
                <!-- Story 2: How to get to top -->
                <div class="story-slide" data-story="1">
                    <div class="story-content">
                        <div class="story-emoji">üìà</div>
                        <h1 data-i18n="onboardingTitle2">–ö–∞–∫ –ø–æ–ø–∞—Å—Ç—å –≤ —Ç–æ–ø?</h1>
                        <p data-i18n="onboardingText2">–¢–≤–æ—è –ø–æ–∑–∏—Ü–∏—è –∑–∞–≤–∏—Å–∏—Ç –æ—Ç –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ —á–∞—Ä—Ç—Å–æ–≤. –ß–µ–º –±–æ–ª—å—à–µ —á–∞—Ä—Ç—Å–æ–≤ ‚Äî —Ç–µ–º –≤—ã—à–µ —Ä–µ–π—Ç–∏–Ω–≥!</p>
                        <p data-i18n="onboardingText2b" class="story-text-secondary">–ß–µ–º –≤—ã—à–µ –≤–∞—à —Ä–µ–π—Ç–∏–Ω–≥, —Ç–µ–º –¥–æ—Ä–æ–∂–µ –ø—Ä–∏–∑—ã, –∫–æ—Ç–æ—Ä—ã–µ –≤—ã –º–æ–∂–µ—Ç–µ –≤—ã–∏–≥—Ä–∞—Ç—å!</p>
                    </div>
                </div>
                
                <!-- Story 3: How to get charts -->
                <div class="story-slide" data-story="2">
                    <div class="story-content">
                        <div class="story-emoji"><span class="charts-icon charts-icon-xl"></span></div>
                        <h1 data-i18n="onboardingTitle3">–ö–∞–∫ –ø–æ–ª—É—á–∏—Ç—å —á–∞—Ä—Ç—Å—ã?</h1>
                        <p data-i18n="onboardingText3">–ü–æ–∫—É–ø–∞–π –∑–∞ TON –∏ STARS –∏–ª–∏ –ø–æ–¥–∞—Ä–∫–∏, –∞ —Ç–∞–∫–∂–µ –∑–∞—Ä–∞–±–∞—Ç—ã–≤–∞–π –±–æ–Ω—É—Å–∞–º–∏ –∑–∞ —Ä–µ—Ñ–µ—Ä–∞–ª–æ–≤.</p>
                    </div>
                </div>
                
                <!-- Story 4: Be creative -->
                <div class="story-slide" data-story="3">
                    <div class="story-content">
                        <div class="story-emoji">‚ú®</div>
                        <h1 data-i18n="onboardingTitle4">–ë—É–¥—å –∫—Ä–µ–∞—Ç–∏–≤–Ω—ã–º!</h1>
                        <p data-i18n="onboardingText4">–ù–∞–ø–∏—à–∏ —Å–æ–æ–±—â–µ–Ω–∏–µ, –∫–æ—Ç–æ—Ä–æ–µ —É–≤–∏–¥—è—Ç –≤—Å–µ: —Ä–µ–∫–ª–∞–º–∞ –ø—Ä–æ–¥—É–∫—Ç–∞, –º–µ–º –∏–ª–∏ —Ñ–∏–ª–æ—Å–æ—Ñ—Å–∫–∞—è –º—ã—Å–ª—å ‚Äî —Ä–µ—à–∞–µ—à—å —Ç—ã!</p>
                    </div>
                </div>
                
                <!-- Story 5: Giveaways -->
                <div class="story-slide" data-story="4">
                    <div class="story-content">
                        <div class="story-emoji">üéÅ</div>
                        <h1 data-i18n="onboardingTitle5">–†–æ–∑—ã–≥—Ä—ã—à–∏!</h1>
                        <p data-i18n="onboardingText5">–í—Å–µ —É—á–∞—Å—Ç–Ω–∏–∫–∏ –ª–∏–¥–µ—Ä–±–æ—Ä–¥–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —É—á–∞—Å—Ç–≤—É—é—Ç –≤ –µ–∂–µ–Ω–µ–¥–µ–ª—å–Ω–æ–º —Ä–æ–∑—ã–≥—Ä—ã—à–µ!</p>
                        <p data-i18n="onboardingText5b" class="story-text-secondary">–ß–µ–º –≤—ã—à–µ –≤–∞—à–µ –º–µ—Å—Ç–æ, —Ç–µ–º –∫—Ä—É—á–µ —Ä–æ–∑—ã–≥—Ä—ã—à!</p>
                    </div>
                </div>
            </div>
            
            <!-- Navigation zones -->
            <div class="story-nav story-nav-prev"></div>
            <div class="story-nav story-nav-next"></div>
            
            <!-- Skip button -->
            <button class="stories-skip" id="skip-onboarding" data-i18n="onboardingSkip">–ü—Ä–æ–ø—É—Å—Ç–∏—Ç—å</button>
            
            <!-- Start button (on last slide) -->
            <button class="stories-start" id="start-app" data-i18n="onboardingStart">–ù–∞—á–∞—Ç—å</button>
        </div>
    </div>

    <div id="app">
        <div class="container">

            <!-- Tab content -->
            <div class="tab-content">
                <!-- All-time leaderboard -->
                <div class="tab-pane active" id="all-time">
                    <div class="leaderboard-header">
                        <h2 data-i18n="leaderboardAllTime">–õ–∏–¥–µ—Ä–±–æ—Ä–¥ –∑–∞ –≤—Å—ë –≤—Ä–µ–º—è</h2>
                    </div>
                    <div id="all-time-list" class="leaderboard-list">
                        <div class="loading">–ó–∞–≥—Ä—É–∑–∫–∞...</div>
                    </div>
                </div>

                <!-- Week leaderboard -->
                <div class="tab-pane" id="week">
                    <div class="week-countdown">
                        <div class="countdown-label" data-i18n="weekResetIn">–î–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è:</div>
                        <div class="countdown-timer" id="week-countdown-timer">
                            <div class="countdown-block">
                                <span class="countdown-value" id="countdown-days">0</span>
                                <span class="countdown-unit" data-i18n="days">–¥</span>
                            </div>
                            <div class="countdown-separator">:</div>
                            <div class="countdown-block">
                                <span class="countdown-value" id="countdown-hours">00</span>
                                <span class="countdown-unit" data-i18n="hours">—á</span>
                            </div>
                            <div class="countdown-separator">:</div>
                            <div class="countdown-block">
                                <span class="countdown-value" id="countdown-minutes">00</span>
                                <span class="countdown-unit" data-i18n="minutes">–º</span>
                            </div>
                            <div class="countdown-separator">:</div>
                            <div class="countdown-block">
                                <span class="countdown-value" id="countdown-seconds">00</span>
                                <span class="countdown-unit" data-i18n="seconds">—Å</span>
                            </div>
                        </div>
                    </div>
                    <div class="leaderboard-header">
                        <h2 data-i18n="leaderboardWeek">–õ–∏–¥–µ—Ä–±–æ—Ä–¥ –∑–∞ –Ω–µ–¥–µ–ª—é</h2>
                    </div>
                    <div id="week-list" class="leaderboard-list">
                        <div class="loading">–ó–∞–≥—Ä—É–∑–∫–∞...</div>
                    </div>
                </div>

                
                <!-- Profile section -->
                <div class="tab-pane" id="profile">
                    <div class="profile-page">
                        <!-- User info -->
                        <div class="profile-user-info">
                            <div class="profile-avatar" id="profile-avatar">
                                <span>U</span>
                            </div>
                            <div class="profile-name-row">
                                <span class="profile-name" id="profile-name">User</span>
                                <button class="profile-name-edit" id="profile-name-edit" title="Edit name">
                                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"/>
                                        <path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"/>
                                    </svg>
                                </button>
                            </div>
                            <div class="profile-original-name" id="profile-original-name"></div>
                            <div class="profile-rank-badge" id="profile-rank-badge">
                                <span class="rank-icon" id="profile-rank-icon">#-</span>
                                <span class="rank-text" data-i18n="yourPosition">–º–µ—Å—Ç–æ –≤ —Ç–æ–ø–µ</span>
                            </div>
                            <div class="profile-stats">
                                <div class="profile-stat highlight">
                                    <span class="stat-value" id="profile-tons">0</span>
                                    <span class="stat-label"><span class="charts-icon charts-icon-sm"></span> <span data-i18n="inLeaderboard">–≤ —Ç–æ–ø–µ</span></span>
                                </div>
                                <div class="profile-stat">
                                    <span class="stat-value" id="profile-refs">0</span>
                                    <span class="stat-label" data-i18n="referralsLabel">—Ä–µ—Ñ–µ—Ä–∞–ª–æ–≤</span>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Balance Section -->
                        <div class="balance-section">
                            <div class="balance-header">
                                <span class="balance-icon"><span class="charts-icon charts-icon-md"></span></span>
                                <span class="balance-title" data-i18n="balanceTitle">–í–∞—à –±–∞–ª–∞–Ω—Å</span>
                            </div>
                            <div class="balance-amount">
                                <span class="balance-value" id="profile-balance">0</span>
                                <span class="balance-unit" data-i18n="charts">—á–∞—Ä—Ç—Å–æ–≤</span>
                            </div>
                            <p class="balance-hint" data-i18n="balanceHint">–ê–∫—Ç–∏–≤–∏—Ä—É–π—Ç–µ —á–∞—Ä—Ç—Å—ã, —á—Ç–æ–±—ã –≤–æ–π—Ç–∏ –≤ –ª–∏–¥–µ—Ä–±–æ—Ä–¥</p>
                            <div class="balance-actions">
                                <button class="btn-activate" id="activate-charts-btn" data-i18n="activateCharts">–ê–∫—Ç–∏–≤–∏—Ä–æ–≤–∞—Ç—å</button>
                            </div>
                        </div>
                        
                        <!-- TON Wallet -->
                        <div class="wallet-section">
                            <div class="wallet-header">
                                <span class="wallet-icon"><span class="charts-icon charts-icon-md"></span></span>
                                <span class="wallet-title" data-i18n="walletTitle">TON –ö–æ—à–µ–ª—ë–∫</span>
                            </div>
                            <div id="ton-connect-container">
                                <button class="btn-wallet" id="ton-connect-btn">
                                    <span class="wallet-btn-icon">üí≥</span>
                                    <span class="wallet-btn-text" data-i18n="connectWallet">–ü–æ–¥–∫–ª—é—á–∏—Ç—å –∫–æ—à–µ–ª—ë–∫</span>
                                </button>
                            </div>
                            <div id="wallet-info" class="wallet-info" style="display: none;">
                                <div class="wallet-address" id="wallet-address"></div>
                                <button class="btn-disconnect" id="disconnect-wallet" data-i18n="disconnectWallet">–û—Ç–∫–ª—é—á–∏—Ç—å</button>
                            </div>
                        </div>
                        
                        <!-- Profile form -->
                        <div class="profile-form">
                            <div class="form-group">
                                <label for="custom-title" data-i18n="customTitleLabel">–ó–∞–≥–æ–ª–æ–≤–æ–∫:</label>
                                <input type="text" id="custom-title" maxlength="50" 
                                       data-i18n-placeholder="customTitlePlaceholder" 
                                       placeholder="–í–∏–¥–µ–Ω –≤ —Ç–æ–ø–µ">
                                <span class="char-counter"><span id="title-char-count">0</span>/50</span>
                            </div>
                            
                            <div class="form-group">
                                <label for="custom-text" data-i18n="customTextLabel">–û–ø–∏—Å–∞–Ω–∏–µ:</label>
                                <textarea id="custom-text" maxlength="200" rows="3"
                                       data-i18n-placeholder="customTextPlaceholder" 
                                       placeholder="–í–∏–¥–Ω–æ –ø—Ä–∏ –Ω–∞–∂–∞—Ç–∏–∏ –Ω–∞ –ø—Ä–æ—Ñ–∏–ª—å..."></textarea>
                                <span class="char-counter"><span id="text-char-count">0</span>/200</span>
                            </div>
                            
                            <div class="form-group">
                                <label for="custom-link" data-i18n="customLinkLabel">–°—Å—ã–ª–∫–∞:</label>
                                <input type="url" id="custom-link" maxlength="500" 
                                       data-i18n-placeholder="customLinkPlaceholder" 
                                       placeholder="https://...">
                            </div>
                            
                            <button class="btn-primary" id="save-profile" data-i18n="saveProfile">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
                            
                            <div class="profile-info">
                                <p data-i18n="profileInfo">–ó–∞–≥–æ–ª–æ–≤–æ–∫ –≤–∏–¥–µ–Ω –≤ —Ç–æ–ø–µ, –æ–ø–∏—Å–∞–Ω–∏–µ –∏ —Å—Å—ã–ª–∫–∞ ‚Äî –ø—Ä–∏ –Ω–∞–∂–∞—Ç–∏–∏!</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- My position block -->
            <div id="my-position" class="my-position" style="display: none;">
                <div class="my-position-content">
                    <span data-i18n="you">–í—ã</span>: #<span id="my-rank">-</span>
                </div>
            </div>

            <!-- Bottom area: Nav + Donate -->
            <div class="bottom-area">
                <!-- Bottom navigation -->
                <nav class="bottom-nav">
                    <button class="nav-item active" data-tab="all-time">
                        <svg class="nav-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M12 2L15.09 8.26L22 9.27L17 14.14L18.18 21.02L12 17.77L5.82 21.02L7 14.14L2 9.27L8.91 8.26L12 2Z"/>
                        </svg>
                        <span class="nav-label" data-i18n="navAllTime">–û–±—â–∏–π</span>
                    </button>
                    <button class="nav-item" data-tab="week">
                        <svg class="nav-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <rect x="3" y="4" width="18" height="18" rx="2" ry="2"/>
                            <line x1="16" y1="2" x2="16" y2="6"/>
                            <line x1="8" y1="2" x2="8" y2="6"/>
                            <line x1="3" y1="10" x2="21" y2="10"/>
                        </svg>
                        <span class="nav-label" data-i18n="navWeek">–ù–µ–¥–µ–ª—è</span>
                    </button>
                    <button class="nav-item" data-tab="profile">
                        <svg class="nav-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"/>
                            <circle cx="12" cy="7" r="4"/>
                        </svg>
                        <span class="nav-label" data-i18n="navProfile">–ü—Ä–æ—Ñ–∏–ª—å</span>
                    </button>
                </nav>
                
                <!-- Donate button -->
                <div class="bottom-donate" id="donate-button-container">
                    <button class="btn-donate" id="donate-btn">
                        <svg class="donate-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"/>
                        </svg>
                        <span class="donate-text" data-i18n="donate">–ü–æ–ø–æ–ª–Ω–∏—Ç—å</span>
                    </button>
                </div>
            </div>
        </div>

        <!-- Donate modal -->
        <div id="donate-modal" class="modal">
            <div class="modal-content">
                <div class="modal-header">
                    <h3 data-i18n="donateTitle">–ü–æ–ø–æ–ª–Ω–∏—Ç—å –¥–æ–Ω–∞—Ç</h3>
                    <button class="modal-close" id="close-modal">&times;</button>
                </div>
                <div class="modal-body">
                    <div class="presets">
                        <button class="preset-btn" data-preset="1" data-amount="">
                            <span class="preset-label" data-i18n="preset1">1 –º–µ—Å—Ç–æ</span>
                            <span class="preset-amount"></span>
                        </button>
                        <button class="preset-btn" data-preset="2" data-amount="">
                            <span class="preset-label" data-i18n="preset2">2 –º–µ—Å—Ç–æ</span>
                            <span class="preset-amount"></span>
                        </button>
                        <button class="preset-btn" data-preset="3" data-amount="">
                            <span class="preset-label" data-i18n="preset3">3 –º–µ—Å—Ç–æ</span>
                            <span class="preset-amount"></span>
                        </button>
                    </div>
                    <div class="custom-amount">
                        <label data-i18n="customAmount">–°–≤–æ—è —Å—É–º–º–∞ (Stars):</label>
                        <input type="number" id="custom-stars" min="1" data-i18n-placeholder="enterAmount" placeholder="–í–≤–µ–¥–∏—Ç–µ —Å—É–º–º—É">
                    </div>
                    
                    <!-- Payment method: Only Telegram Stars (crypto requires provider setup) -->
                    
                    <button class="btn-primary" id="create-invoice-btn" disabled data-i18n="createPayment">–°–æ–∑–¥–∞—Ç—å –ø–ª–∞—Ç–µ–∂</button>
                </div>
            </div>
        </div>

        <!-- User profile modal (for viewing other users) -->
        <div id="user-profile-modal" class="user-profile-modal">
            <div class="user-profile-content">
                <button class="user-profile-close" id="close-user-profile">&times;</button>
                <div class="user-profile-header">
                    <div class="user-profile-avatar" id="user-profile-avatar">
                        <span>U</span>
                    </div>
                    <div class="user-profile-name" id="user-profile-name">User</div>
                    <div class="user-profile-username" id="user-profile-username">@username</div>
                </div>
                <div class="user-profile-stats">
                    <div class="user-profile-stat">
                        <span class="stat-value" id="user-profile-tons">0</span>
                        <span class="stat-label"><span class="charts-icon charts-icon-sm"></span></span>
                    </div>
                    <div class="user-profile-stat">
                        <span class="stat-value" id="user-profile-rank">#1</span>
                        <span class="stat-label" data-i18n="position">–º–µ—Å—Ç–æ</span>
                    </div>
                </div>
                <div class="user-profile-custom-text" id="user-profile-custom-text"></div>
                <a href="#" class="user-profile-link" id="user-profile-link" style="display: none;">
                    <span class="link-icon">üîó</span>
                    <span class="link-text" id="user-profile-link-text"></span>
                </a>
            </div>
        </div>
        <div id="user-profile-backdrop" class="user-profile-backdrop"></div>

        <!-- Edit Display Name Modal -->
        <div id="edit-name-modal" class="edit-name-modal">
            <div class="edit-name-content">
                <h3 data-i18n="editDisplayName">–ò–∑–º–µ–Ω–∏—Ç—å –∏–º—è</h3>
                <input type="text" id="edit-name-input" maxlength="50" 
                       data-i18n-placeholder="displayNamePlaceholder" 
                       placeholder="–ö–∞–∫ –≤–∞—Å –Ω–∞–∑—ã–≤–∞—Ç—å?">
                <div class="edit-name-hint" data-i18n="displayNameHint">–ë—É–¥–µ—Ç –æ—Ç–æ–±—Ä–∞–∂–∞—Ç—å—Å—è –≤ —Ç–æ–ø–µ</div>
                <div class="edit-name-buttons">
                    <button class="btn-secondary" id="edit-name-cancel" data-i18n="cancel">–û—Ç–º–µ–Ω–∞</button>
                    <button class="btn-primary" id="edit-name-save" data-i18n="save">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
                </div>
            </div>
        </div>
        <div id="edit-name-backdrop" class="edit-name-backdrop"></div>

        <!-- Activate Charts Modal -->
        <div id="activate-modal" class="activate-modal">
            <div class="activate-content">
                <h3 data-i18n="activateChartsTitle">–ê–∫—Ç–∏–≤–∏—Ä–æ–≤–∞—Ç—å —á–∞—Ä—Ç—Å—ã</h3>
                <p class="activate-balance" data-i18n="availableBalance">–î–æ—Å—Ç—É–ø–Ω–æ: <span id="activate-available">0</span> —á–∞—Ä—Ç—Å–æ–≤</p>
                <div class="activate-input-group">
                    <input type="number" id="activate-amount" min="1" step="1" 
                           data-i18n-placeholder="enterAmount" 
                           placeholder="–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ">
                    <button class="btn-max" id="activate-max" data-i18n="max">MAX</button>
                </div>
                <p class="activate-hint" data-i18n="activateHint">–ß–∞—Ä—Ç—Å—ã –±—É–¥—É—Ç –¥–æ–±–∞–≤–ª–µ–Ω—ã –≤ —Ç–µ–∫—É—â–∏–π –Ω–µ–¥–µ–ª—å–Ω—ã–π –ª–∏–¥–µ—Ä–±–æ—Ä–¥</p>
                <div class="activate-buttons">
                    <button class="btn-secondary" id="activate-cancel" data-i18n="cancel">–û—Ç–º–µ–Ω–∞</button>
                    <button class="btn-primary" id="activate-confirm" data-i18n="activate">–ê–∫—Ç–∏–≤–∏—Ä–æ–≤–∞—Ç—å</button>
                </div>
            </div>
        </div>
        <div id="activate-backdrop" class="activate-backdrop"></div>

    </div>

    <script src="onboarding.js"></script>
    <script src="tonconnect.js"></script>
    <script src="app.js?v=4"></script>
</body>
</html>

